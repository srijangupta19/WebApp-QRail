<!DOCTYPE html>

<html lang="en">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  Â  <title>Lot Details - Indian Railways</title>

Â  Â  <style>

Â  Â  Â  Â  /* General Styles */

Â  Â  Â  Â  body {

Â  Â  Â  Â  Â  Â  font-family: 'Times New Roman', Times, serif;

Â  Â  Â  Â  Â  Â  background-color: #f0f2f5;

Â  Â  Â  Â  Â  Â  margin: 0;

Â  Â  Â  Â  Â  Â  color: #333;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  min-height: 100vh;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Header Styles */

Â  Â  Â  Â  .header {

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  padding: 10px 20px;

Â  Â  Â  Â  Â  Â  background-color: #0d47a1;

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  justify-content: space-between;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  box-sizing: border-box;

Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

Â  Â  Â  Â  }



Â  Â  Â  Â  .header .logo {

Â  Â  Â  Â  Â  Â  text-align: right;

Â  Â  Â  Â  Â  Â  line-height: 1.2;

Â  Â  Â  Â  }



Â  Â  Â  Â  .header .logo .app-name {

Â  Â  Â  Â  Â  Â  font-size: 1.5em;

Â  Â  Â  Â  Â  Â  font-weight: bold;

Â  Â  Â  Â  }



Â  Â  Â  Â  .header .logo .app-subname {

Â  Â  Â  Â  Â  Â  font-size: 0.9em;

Â  Â  Â  Â  Â  Â  display: block;

Â  Â  Â  Â  }



Â  Â  Â  Â  .header .back-button {

Â  Â  Â  Â  Â  Â  font-size: 1.5em;

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  Â  Â  text-decoration: none;

Â  Â  Â  Â  Â  Â  cursor: pointer;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Top Button Container */

Â  Â  Â  Â  .top-button-container {

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  padding: 10px 20px;

Â  Â  Â  Â  Â  Â  box-sizing: border-box;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  justify-content: flex-end;

Â  Â  Â  Â  Â  Â  margin-top: 10px;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Main Content and Container */

Â  Â  Â  Â  .main-container {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-wrap: wrap;

Â  Â  Â  Â  Â  Â  padding: 20px;

Â  Â  Â  Â  Â  Â  gap: 20px;

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  }



Â  Â  Â  Â  .content-section {

Â  Â  Â  Â  Â  Â  background-color: white;

Â  Â  Â  Â  Â  Â  padding: 20px;

Â  Â  Â  Â  Â  Â  border-radius: 8px;

Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

Â  Â  Â  Â  Â  Â  flex: 1 1 300px;

Â  Â  Â  Â  }



Â  Â  Â  Â  .content-section.history-section {

Â  Â  Â  Â  Â  Â  flex: 2 1 400px;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  }



Â  Â  Â  Â  .history-list {

Â  Â  Â  Â  Â  Â  list-style: none;

Â  Â  Â  Â  Â  Â  padding: 0;

Â  Â  Â  Â  Â  Â  margin: 0;

Â  Â  Â  Â  }



Â  Â  Â  Â  .history-list li {

Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #eee;

Â  Â  Â  Â  Â  Â  padding: 10px 0;

Â  Â  Â  Â  }



Â  Â  Â  Â  h2 {

Â  Â  Â  Â  Â  Â  margin-top: 0;

Â  Â  Â  Â  Â  Â  font-size: 1.5em;

Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #ccc;

Â  Â  Â  Â  Â  Â  padding-bottom: 10px;

Â  Â  Â  Â  Â  Â  margin-bottom: 20px;

Â  Â  Â  Â  }



Â  Â  Â  Â  .details-card {

Â  Â  Â  Â  Â  Â  border: 1px solid #ddd;

Â  Â  Â  Â  Â  Â  border-radius: 6px;

Â  Â  Â  Â  Â  Â  padding: 15px;

Â  Â  Â  Â  Â  Â  margin-bottom: 20px;

Â  Â  Â  Â  Â  Â  background-color: #f9f9f9;

Â  Â  Â  Â  }



Â  Â  Â  Â  .details-card p {

Â  Â  Â  Â  Â  Â  margin: 5px 0;

Â  Â  Â  Â  Â  Â  line-height: 1.5;

Â  Â  Â  Â  }



Â  Â  Â  Â  .details-card strong {

Â  Â  Â  Â  Â  Â  display: inline-block;

Â  Â  Â  Â  Â  Â  min-width: 100px;

Â  Â  Â  Â  }



Â  Â  Â  Â  .feed-faults-btn {

Â  Â  Â  Â  Â  Â  background-color: #2e7d32;

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  Â  Â  border: none;

Â  Â  Â  Â  Â  Â  padding: 15px 30px;

Â  Â  Â  Â  Â  Â  font-size: 1em;

Â  Â  Â  Â  Â  Â  font-weight: bold;

Â  Â  Â  Â  Â  Â  border-radius: 8px;

Â  Â  Â  Â  Â  Â  cursor: pointer;

Â  Â  Â  Â  Â  Â  text-align: center;

Â  Â  Â  Â  Â  Â  transition: background-color 0.3s ease;

Â  Â  Â  Â  }



Â  Â  Â  Â  .feed-faults-btn:hover {

Â  Â  Â  Â  Â  Â  background-color: #1b5e20;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Responsive Layout */

Â  Â  Â  Â  @media (max-width: 768px) {

Â  Â  Â  Â  Â  Â  .main-container {

Â  Â  Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  </style>

Â  Â  <script type="module">

Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

Â  Â  Â  Â  import {

Â  Â  Â  Â  Â  Â  getFirestore, collection, getDocs, doc, getDoc

Â  Â  Â  Â  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";



Â  Â  Â  Â  // ðŸ”¹ Firebase Config

Â  Â  Â  Â  const firebaseConfig = {

Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyDVaRCfAz11NtcXp0WpDhHCc85QuyEbFSk",

Â  Â  Â  Â  Â  Â  authDomain: "sih-trial-122f8.firebaseapp.com",

Â  Â  Â  Â  Â  Â  projectId: "sih-trial-122f8",

Â  Â  Â  Â  Â  Â  storageBucket: "sih-trial-122f8.appspot.com",

Â  Â  Â  Â  Â  Â  messagingSenderId: "773497361291",

Â  Â  Â  Â  Â  Â  appId: "1:773497361291:web:3dc8ed3f42164c144c158e",

Â  Â  Â  Â  Â  Â  measurementId: "G-VJGRQZ71CB"

Â  Â  Â  Â  };



Â  Â  Â  Â  const app = initializeApp(firebaseConfig);

Â  Â  Â  Â  const db = getFirestore(app);

Â  Â  Â  Â  let currentQR = new URLSearchParams(window.location.search).get("qr");

Â  Â  Â  Â  const sections = ["Rail", "Rail Clip", "Sleeper", "Liner", "Rail Pad", "Joint"];



Â  Â  Â  Â  // ðŸ”¹ Fetch and Render Data

Â  Â  Â  Â  async function fetchDetails() {

Â  Â  Â  Â  Â  Â  if (!currentQR) {

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.main-container').innerHTML = '<p>No QR code scanned. Please go back and scan a QR code.</p>';

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  const historyList = document.getElementById("historyList");

Â  Â  Â  Â  Â  Â  const lotDetailsContainer = document.getElementById("lotDetails");

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  historyList.innerHTML = '<p>Loading history...</p>';

Â  Â  Â  Â  Â  Â  lotDetailsContainer.innerHTML = '<p>Loading details...</p>';



Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  // Fetch Lot History

Â  Â  Â  Â  Â  Â  Â  Â  const qrRef = doc(db, "railway_parts", currentQR);

Â  Â  Â  Â  Â  Â  Â  Â  const qrSnap = await getDoc(qrRef);

Â  Â  Â  Â  Â  Â  Â  Â  if (qrSnap.exists()) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = qrSnap.data();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const inspectionHistory = data.inspection_history || [];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  historyList.innerHTML = "";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (inspectionHistory.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  historyList.innerHTML = "<p>No inspection history available.</p>";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inspectionHistory.forEach(historyItem => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement("li");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.textContent = `Date: ${historyItem.date}, Status: ${historyItem.status}`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  historyList.appendChild(li);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  historyList.innerHTML = "<p>No QR lot found in database.</p>";

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  // Fetch Parts Details

Â  Â  Â  Â  Â  Â  Â  Â  const partsRef = collection(db, "railway_parts", currentQR, "parts");

Â  Â  Â  Â  Â  Â  Â  Â  const partsSnap = await getDocs(partsRef);

Â  Â  Â  Â  Â  Â  Â  Â  lotDetailsContainer.innerHTML = ""; // Clear existing content

Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (partsSnap.empty) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lotDetailsContainer.innerHTML = "<p>No parts found for this QR code.</p>";

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const partsByType = {};

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partsSnap.forEach(docSnap => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = { id: docSnap.id, ...docSnap.data() };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const type = data.part_type.toLowerCase();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!partsByType[type]) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partsByType[type] = [];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partsByType[type].push(data);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sections.forEach(sectionName => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const type = sectionName.toLowerCase();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (partsByType[type]) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const partData = partsByType[type][0]; // Assuming one entry per type

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const detailsCard = createDetailsCard(partData);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lotDetailsContainer.appendChild(detailsCard);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching data: ", error);

Â  Â  Â  Â  Â  Â  Â  Â  lotDetailsContainer.innerHTML = "<p>Error loading details. Please try again.</p>";

Â  Â  Â  Â  Â  Â  Â  Â  historyList.innerHTML = "<p>Error loading history.</p>";

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  function createDetailsCard(data) {

Â  Â  Â  Â  Â  Â  const cardDiv = document.createElement("div");

Â  Â  Â  Â  Â  Â  cardDiv.className = "details-card";



Â  Â  Â  Â  Â  Â  cardDiv.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  <h3>${data.part_type}</h3>

Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Vendor:</strong> ${data.vendor || "N/A"}</p>

Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Mfg. Date:</strong> ${data.manufacture_date || "N/A"}</p>

Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  return cardDiv;

Â  Â  Â  Â  }



Â  Â  Â  Â  // ðŸ”¹ Navigate to faults page

Â  Â  Â  Â  window.goToFaults = function() {

Â  Â  Â  Â  Â  Â  if (currentQR) {

Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = `feed_faults.html?qr=${encodeURIComponent(currentQR)}`;

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  alert("No QR code detected.");

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };



Â  Â  Â  Â  // Initialize on page load

Â  Â  Â  Â  window.addEventListener("DOMContentLoaded", fetchDetails);

Â  Â  </script>

</head>

<body>

Â  Â  <header class="header">

Â  Â  Â  Â  <button class="back-button" onclick="window.location.href='scan.html'">&#x2630;</button>

Â  Â  Â  Â  <div class="logo">

Â  Â  Â  Â  Â  Â  <span class="app-name">à¤­à¤¾à¤°à¤¤à¥€à¤¯ à¤°à¥‡à¤²</span>

Â  Â  Â  Â  Â  Â  <span class="app-subname">INDIAN RAILWAYS</span>

Â  Â  Â  Â  </div>

Â  Â  </header>



Â  Â  <div class="top-button-container">

Â  Â  Â  Â  <button class="feed-faults-btn" onclick="goToFaults()">FEED FAULTS</button>

Â  Â  </div>



Â  Â  <main class="main-container">

Â  Â  Â  Â  <section class="content-section">

Â  Â  Â  Â  Â  Â  <h2>Lot Details</h2>

Â  Â  Â  Â  Â  Â  <div id="lotDetails">

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </section>



Â  Â  Â  Â  <section class="content-section history-section">

Â  Â  Â  Â  Â  Â  <h2>History</h2>

Â  Â  Â  Â  Â  Â  <ul id="historyList">

Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  </section>

Â  Â  </main>

</body>

</html>
